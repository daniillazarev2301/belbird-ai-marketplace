# üöÄ –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ BelBird –Ω–∞ VDS

–ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é BelBird –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º VDS —Å–µ—Ä–≤–µ—Ä–µ.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-—Å–µ—Ä–≤–µ—Ä—É)
2. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
3. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Supabase](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-supabase)
4. [–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Edge Functions](#—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ-edge-functions)
5. [–°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞](#—Å–±–æ—Ä–∫–∞-–∏-–¥–µ–ø–ª–æ–π-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
6. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-nginx)
7. [SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã](#ssl-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)
8. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
9. [–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö](#–º–∏–≥—Ä–∞—Ü–∏—è-–¥–∞–Ω–Ω—ã—Ö)
10. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)

---

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **CPU**: 2 —è–¥—Ä–∞
- **RAM**: 4 GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8 GB)
- **SSD**: 40 GB
- **OS**: Ubuntu 22.04 LTS / Debian 12

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **CPU**: 4 —è–¥—Ä–∞
- **RAM**: 8 GB
- **SSD**: 80 GB
- **OS**: Ubuntu 22.04 LTS

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
| –ü–æ—Ä—Ç | –°–µ—Ä–≤–∏—Å |
|------|--------|
| 22 | SSH |
| 80 | HTTP |
| 443 | HTTPS |
| 5432 | PostgreSQL (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ) |
| 8000 | Supabase Kong API Gateway |
| 9000 | Edge Functions Gateway |

---

## üîß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@YOUR_SERVER_IP
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
apt update && apt upgrade -y
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

```bash
apt install -y \
  curl \
  wget \
  git \
  htop \
  nano \
  ufw \
  fail2ban \
  certbot \
  python3-certbot-nginx
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
curl -fsSL https://get.docker.com | sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
usermod -aG docker $USER

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose Plugin
apt install docker-compose-plugin -y

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker --version
docker compose version
```

### –®–∞–≥ 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx

```bash
apt install nginx -y
systemctl enable nginx
systemctl start nginx
```

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞

```bash
ufw allow ssh
ufw allow http
ufw allow https
ufw --force enable
ufw status
```

### –®–∞–≥ 7: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```bash
mkdir -p /opt/belbird
mkdir -p /opt/supabase
mkdir -p /var/www/belbird
```

---

## üóÑÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Supabase

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Supabase

```bash
cd /opt/supabase
git clone --depth 1 https://github.com/supabase/supabase.git .
cd docker
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
nano .env
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```bash
############
# Secrets - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ú–ï–ù–ò–¢–ï!
############

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT Secret (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ)
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Anon Key - –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Service Role Key - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Dashboard –ø–∞—Ä–æ–ª—å
DASHBOARD_PASSWORD=your-secure-dashboard-password

# PostgreSQL –ø–∞—Ä–æ–ª—å
POSTGRES_PASSWORD=your-secure-postgres-password

############
# URLs
############
SITE_URL=https://belbird.ru
API_EXTERNAL_URL=https://api.belbird.ru

############
# Email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
############
SMTP_HOST=smtp.yandex.ru
SMTP_PORT=465
SMTP_USER=noreply@belbird.ru
SMTP_PASS=your-smtp-password
SMTP_SENDER_NAME=BelBird
```

### –®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT –∫–ª—é—á–µ–π

–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (–∏–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å Node.js):

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ supabase CLI (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
npm install -g supabase

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
node -e "
const jwt = require('jsonwebtoken');
const jwtSecret = require('crypto').randomBytes(32).toString('hex');
console.log('JWT_SECRET=' + jwtSecret);
console.log('');

const anonPayload = {
  role: 'anon',
  iss: 'supabase',
  iat: Math.floor(Date.now() / 1000),
  exp: Math.floor(Date.now() / 1000) + (10 * 365 * 24 * 60 * 60)
};
console.log('ANON_KEY=' + jwt.sign(anonPayload, jwtSecret));
console.log('');

const servicePayload = {
  role: 'service_role',
  iss: 'supabase',
  iat: Math.floor(Date.now() / 1000),
  exp: Math.floor(Date.now() / 1000) + (10 * 365 * 24 * 60 * 60)
};
console.log('SERVICE_ROLE_KEY=' + jwt.sign(servicePayload, jwtSecret));
"
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ Supabase

```bash
cd /opt/supabase/docker
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# API –¥–æ–ª–∂–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å
curl http://localhost:8000/rest/v1/

# Studio Dashboard
curl http://localhost:3000
```

---

## ‚ö° –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Edge Functions

### –®–∞–≥ 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd /opt/belbird

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
git clone https://github.com/YOUR_USERNAME/belbird.git .

# –ò–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ SCP —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
# scp -r ./docker root@YOUR_SERVER_IP:/opt/belbird/
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cd /opt/belbird/docker
cp .env.example .env
nano .env
```

**–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```bash
# Supabase (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —à–∞–≥–∞ –≤—ã—à–µ)
SUPABASE_URL=http://localhost:8000
SUPABASE_ANON_KEY=your-anon-key-from-above
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-from-above

# AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω)
AI_PROVIDER=yandex

# YandexGPT
YANDEX_API_KEY=your-yandex-api-key
YANDEX_FOLDER_ID=your-folder-id

# –ò–ª–∏ GigaChat
# GIGACHAT_TOKEN=your-gigachat-token

# –ò–ª–∏ OpenRouter
# OPENROUTER_API_KEY=your-openrouter-key

# Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (VAPID –∫–ª—é—á–∏)
VAPID_PUBLIC_KEY=your-vapid-public-key
VAPID_PRIVATE_KEY=your-vapid-private-key

# –î–æ—Å—Ç–∞–≤–∫–∞
CDEK_CLIENT_ID=your-cdek-client-id
CDEK_CLIENT_SECRET=your-cdek-secret
BOXBERRY_TOKEN=your-boxberry-token

# –û–ø–ª–∞—Ç–∞
ALFA_USERNAME=your-alfa-username
ALFA_PASSWORD=your-alfa-password
```

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ YandexGPT –≤–µ—Ä—Å–∏–π —Ñ—É–Ω–∫—Ü–∏–π

```bash
# –ó–∞–º–µ–Ω–∞ AI —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ YandexGPT –≤–µ—Ä—Å–∏–∏
cp /opt/belbird/docker/functions-adapted/ai-chat-yandex/index.ts \
   /opt/belbird/supabase/functions/ai-chat/index.ts

cp /opt/belbird/docker/functions-adapted/visual-search-yandex/index.ts \
   /opt/belbird/supabase/functions/visual-search/index.ts

cp /opt/belbird/docker/functions-adapted/generate-product-content-yandex/index.ts \
   /opt/belbird/supabase/functions/generate-product-content/index.ts

cp /opt/belbird/docker/functions-adapted/generate-blog-content-yandex/index.ts \
   /opt/belbird/supabase/functions/generate-blog-content/index.ts

cp /opt/belbird/docker/functions-adapted/generate-reviews-yandex/index.ts \
   /opt/belbird/supabase/functions/generate-reviews/index.ts
```

### –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è VAPID –∫–ª—é—á–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ web-push CLI
npm install -g web-push

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
web-push generate-vapid-keys

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –≤ .env —Ñ–∞–π–ª
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ Edge Functions

```bash
cd /opt/belbird/docker

# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x scripts/*.sh

# –ó–∞–ø—É—Å–∫
./scripts/start.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker compose -f docker-compose.functions.yml ps
```

### –®–∞–≥ 6: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
cd /opt/belbird/docker/systemd
chmod +x *.sh
sudo ./install-services.sh

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl start belbird-supabase
sudo systemctl start belbird-functions

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status belbird-supabase
sudo systemctl status belbird-functions
```

---

## üé® –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
cd /path/to/belbird

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–æ–∑–¥–∞–Ω–∏–µ .env –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
cat > .env.production << EOF
VITE_SUPABASE_URL=https://api.belbird.ru
VITE_SUPABASE_PUBLISHABLE_KEY=your-anon-key
VITE_SUPABASE_PROJECT_ID=belbird
EOF

# –°–±–æ—Ä–∫–∞
npm run build

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp -r dist/* root@YOUR_SERVER_IP:/var/www/belbird/
```

### –®–∞–≥ 2: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äî —Å–±–æ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/belbird

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
apt install -y nodejs

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–±–æ—Ä–∫–∞
npm install
npm run build

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
cp -r dist/* /var/www/belbird/
```

---

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–∞–π—Ç–∞

```bash
nano /etc/nginx/sites-available/belbird
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:**

```nginx
# HTTP -> HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç
server {
    listen 80;
    server_name belbird.ru www.belbird.ru;
    return 301 https://$server_name$request_uri;
}

# –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç
server {
    listen 443 ssl http2;
    server_name belbird.ru www.belbird.ru;

    # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –ø–æ–∑–∂–µ)
    ssl_certificate /etc/letsencrypt/live/belbird.ru/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/belbird.ru/privkey.pem;

    # SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;

    # –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
    root /var/www/belbird;
    index index.html;

    # Gzip —Å–∂–∞—Ç–∏–µ
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;

    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # SPA —Ä–æ—É—Ç–∏–Ω–≥
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Edge Functions API
    location /functions/v1/ {
        proxy_pass http://127.0.0.1:9000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 300s;
    }

    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
}
```

### –®–∞–≥ 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–º–µ–Ω)

```bash
nano /etc/nginx/sites-available/belbird-api
```

```nginx
server {
    listen 80;
    server_name api.belbird.ru;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name api.belbird.ru;

    ssl_certificate /etc/letsencrypt/live/api.belbird.ru/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.belbird.ru/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;

    # Supabase API
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 300s;
    }
}
```

### –®–∞–≥ 3: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
ln -s /etc/nginx/sites-available/belbird /etc/nginx/sites-enabled/
ln -s /etc/nginx/sites-available/belbird-api /etc/nginx/sites-enabled/

# –£–¥–∞–ª–µ–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —Å–∞–π—Ç–∞
rm /etc/nginx/sites-enabled/default

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl reload nginx
```

---

## üîí SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

### –®–∞–≥ 1: –í—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑ SSL

```bash
# –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ SSL —Å—Ç—Ä–æ–∫–∏ –≤ nginx –∫–æ–Ω—Ñ–∏–≥–µ
nano /etc/nginx/sites-available/belbird
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ ssl_certificate –∏ ssl_certificate_key

# –ò–∑–º–µ–Ω–∏—Ç–µ listen 443 ssl http2 –Ω–∞ listen 80
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx
nginx -t && systemctl reload nginx
```

### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

```bash
# –î–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞
certbot --nginx -d belbird.ru -d www.belbird.ru

# –î–ª—è API –¥–æ–º–µ–Ω–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
certbot --nginx -d api.belbird.ru

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
certbot renew --dry-run
```

### –®–∞–≥ 3: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –í–µ—Ä–Ω–∏—Ç–µ SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ nginx –∫–æ–Ω—Ñ–∏–≥
nano /etc/nginx/sites-available/belbird

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx
nginx -t && systemctl reload nginx
```

---

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º, –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω
4. –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É –∏ –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞
5. –ü–æ–ª—É—á–∏—Ç–µ Chat ID:
   ```bash
   curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates"
   ```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
cd /opt/belbird/docker
cp .env.monitor.example .env.monitor
nano .env.monitor
```

```bash
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=-100123456789
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
cp /opt/belbird/docker/systemd/belbird-monitor.service /etc/systemd/system/

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏ –∫ .env
nano /etc/systemd/system/belbird-monitor.service
# –ò–∑–º–µ–Ω–∏—Ç–µ EnvironmentFile –Ω–∞ /opt/belbird/docker/.env.monitor

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è
systemctl daemon-reload
systemctl enable belbird-monitor
systemctl start belbird-monitor

# –ü—Ä–æ–≤–µ—Ä–∫–∞
systemctl status belbird-monitor
journalctl -u belbird-monitor -f
```

### –®–∞–≥ 4: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
source /opt/belbird/docker/.env.monitor
/opt/belbird/docker/scripts/monitor.sh

# –î–µ–º–æ–Ω —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
/opt/belbird/docker/scripts/monitor.sh --daemon 60
```

---

## üì§ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 1: –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Lovable Cloud

–í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ BelBird:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª (–¢–æ–≤–∞—Ä—ã, –ö–∞—Ç–µ–≥–æ—Ä–∏–∏, –ó–∞–∫–∞–∑—ã –∏ —Ç.–¥.)
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel"
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
docker exec -it supabase-db psql -U postgres

# –ò–ª–∏ —á–µ—Ä–µ–∑ psql
psql "postgresql://postgres:YOUR_PASSWORD@localhost:5432/postgres"
```

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –ø–∞–ø–∫–∏ `supabase/migrations/` –≤ –ø–æ—Ä—è–¥–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è.

### –®–∞–≥ 3: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

```bash
# –ß–µ—Ä–µ–∑ Supabase Studio
# –û—Ç–∫—Ä–æ–π—Ç–µ http://YOUR_SERVER_IP:3000
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Table Editor
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Import CSV/JSON

# –ò–ª–∏ —á–µ—Ä–µ–∑ SQL
psql "postgresql://postgres:YOUR_PASSWORD@localhost:5432/postgres" < backup.sql
```

### –®–∞–≥ 4: –ú–∏–≥—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ Storage

```bash
# –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ Lovable Cloud Storage
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ—Ä–µ–∑ Supabase Studio -> Storage
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Supabase CLI
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ß–µ–∫-–ª–∏—Å—Ç

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase API
curl -s https://api.belbird.ru/rest/v1/ | head

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Edge Functions
curl -s https://belbird.ru/functions/v1/ai-chat \
  -H "Content-Type: application/json" \
  -d '{"message":"–ü—Ä–∏–≤–µ—Ç"}'

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
curl -I https://belbird.ru

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL
openssl s_client -connect belbird.ru:443 -servername belbird.ru

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–æ–≤
systemctl status belbird-supabase
systemctl status belbird-functions
systemctl status belbird-monitor

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
journalctl -u belbird-functions -n 50
docker logs edge-gateway --tail 50
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

1. **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** ‚Äî https://belbird.ru
2. **–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤** ‚Äî https://belbird.ru/catalog
3. **AI —á–∞—Ç** ‚Äî –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–∏–¥–∂–µ—Ç —á–∞—Ç–∞
4. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî https://belbird.ru/auth
5. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** ‚Äî https://belbird.ru/admin

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

```bash
cd /opt/belbird
git pull origin main

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
npm install
npm run build
cp -r dist/* /var/www/belbird/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Edge Functions
./docker/scripts/update.sh
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Supabase

```bash
cd /opt/supabase/docker
git pull
docker compose pull
docker compose up -d
```

---

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
df -h
free -m

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Docker
systemctl restart docker
```

### 502 Bad Gateway

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ backend
curl http://localhost:8000/rest/v1/
curl http://localhost:9000/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx
nginx -t
tail -f /var/log/nginx/error.log
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
certbot renew --force-renewal

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
certbot certificates
```

### –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
htop
docker stats

# –õ–æ–≥–∏
journalctl -u belbird-functions -f
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: `/opt/belbird/docker/README.md`
- **Edge Functions**: `/opt/belbird/docker/functions-adapted/README.md`
- **Systemd —Å–µ—Ä–≤–∏—Å—ã**: `/opt/belbird/docker/systemd/README.md`

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –î–µ–∫–∞–±—Ä—å 2024*
